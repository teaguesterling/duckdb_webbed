# name: test/sql/html_type_inference.test
# description: Test type inference for read_html (feature parity with read_xml)
# group: [sql]

require webbed

# Test 1: Multiple span elements with class attributes become an array with class preserved
# NOTE: The class attribute values don't become field names; spans are just grouped as repeated elements
query TTTTTT
DESCRIBE SELECT span FROM read_html('test/html/type_inference_test.html', record_element:='li');
----
span	STRUCT("class" VARCHAR)[]	YES	NULL	NULL	NULL

# Test 2: Verify span is an array type
query I
SELECT typeof(span)
FROM read_html('test/html/type_inference_test.html', record_element:='li')
LIMIT 1;
----
STRUCT("class" VARCHAR)[]

# Test 3: With attr_mode:='discard', time element content is inferred as DATE
# TODO(future): Special handling for semantic HTML elements like <time> to infer types even with attributes
query T
SELECT typeof(time)
FROM read_html('test/html/type_inference_test.html', record_element:='li', attr_mode:='discard')
LIMIT 1;
----
DATE

# Test 4: Verify time values are correctly typed as dates with attr_mode:='discard'
query T
SELECT time
FROM read_html('test/html/type_inference_test.html', record_element:='li', attr_mode:='discard')
ORDER BY time;
----
2015-03-10
2018-06-20
2020-01-15

# Test 5: Verify span array contains class attributes
query I
SELECT array_length(span)
FROM read_html('test/html/type_inference_test.html', record_element:='li')
LIMIT 1;
----
5
