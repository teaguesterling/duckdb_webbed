# name: test/sql/html_validation.test
# description: Test validation and constraints for read_html (feature parity with read_xml)
# group: [sql]

require webbed

# Test 1: max_depth=-1 means unlimited depth (consistent with read_json)
statement ok
SELECT * FROM read_html('test/html/complex_types_test.html', record_element:='article', max_depth:=-1) LIMIT 0;

# Test 1b: Other negative values for max_depth should throw an error
statement error
SELECT * FROM read_html('test/html/complex_types_test.html', record_element:='article', max_depth:=-5) LIMIT 0;
----
max_depth must be -1

# Test 2: Verify parameter validation - maximum_file_size must be positive
statement error
SELECT * FROM read_html('test/html/complex_types_test.html', maximum_file_size:=-100);
----
Invalid Input Error

# Test 3: Empty file list should return empty result set
# TODO: Empty file list currently errors instead of returning empty result
statement error
CREATE TEMP TABLE empty_files AS
SELECT * FROM read_html(CAST([] AS VARCHAR[]), record_element:='item');
----
No files found

# Test 4: Verify attr_mode parameter accepts only valid values
statement error
SELECT * FROM read_html('test/html/complex_types_test.html', record_element:='article', attr_mode:='invalid_mode');
----
Invalid attr_mode

# Test 5: Verify namespaces parameter accepts only valid values
statement error
SELECT * FROM read_html('test/html/complex_types_test.html', record_element:='article', namespaces:='invalid_value');
----
Invalid namespaces

# Test 6: Verify empty_elements parameter accepts only valid values
statement error
SELECT * FROM read_html('test/html/complex_types_test.html', record_element:='article', empty_elements:='invalid_value');
----
Invalid empty_elements

# Test 7: Test that HTML files are properly validated before processing
query I
SELECT typeof(header)
FROM read_html('test/html/complex_types_test.html', record_element:='article')
LIMIT 1;
----
STRUCT("employee-id" INTEGER, "full-name" VARCHAR)

# Test 8: Verify read_html works with filename parameter
# TODO(GitHub #48): filename parameter not working with union_by_name
statement error
SELECT count(*), count(DISTINCT filename)
FROM read_html(['test/html/union_file1.html', 'test/html/union_file2.html'], record_element:='data-item', filename:=true);
----
Binder Error
