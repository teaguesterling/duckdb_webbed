# name: test/sql/xml_rss_feed.test
# description: Test RSS feed parsing with automatic item detection (issue #13)
# group: [sql]

require webbed

# Test that RSS feed automatically detects and returns all items
query I
SELECT count(*) FROM read_xml('test/xml/rss_feed.xml');
----
3

# Test that we get the item titles, not channel metadata
query I
SELECT title FROM read_xml('test/xml/rss_feed.xml') ORDER BY title;
----
First Article
Second Article
Third Article

# Test that we get all item fields
query IIIII
SELECT title, link, description, pubDate, guid
FROM read_xml('test/xml/rss_feed.xml')
ORDER BY guid;
----
First Article	https://example.com/articles/first	This is the first article in our feed	Mon, 01 Jan 2024 10:00:00 GMT	article-1
Second Article	https://example.com/articles/second	This is the second article in our feed	Mon, 01 Jan 2024 11:00:00 GMT	article-2
Third Article	https://example.com/articles/third	This is the third article in our feed	Mon, 01 Jan 2024 12:00:00 GMT	article-3

# Test that force_list parameter works with simple tag name
query I
SELECT count(*) FROM read_xml('test/xml/rss_feed.xml', force_list := 'item');
----
3

# Test that force_list parameter works with XPath
query I
SELECT count(*) FROM read_xml('test/xml/rss_feed.xml', force_list := '//item');
----
3

# Verify read_xml_objects returns the raw XML document
query I
SELECT count(*) FROM read_xml_objects('test/xml/rss_feed.xml');
----
1
